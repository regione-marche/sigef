
CREATE PROCEDURE [dbo].[SpGetPrioritaDisposizioniAttuative]
(
	@ID_BANDO INT,
	@LIVELLO CHAR(1),
	@ID_PROGETTO INT=NULL
)
AS
	SELECT B.ID_BANDO,B.ID_SCHEDA_VALUTAZIONE,P.ID_PRIORITA,P.DESCRIZIONE AS PRIORITA,P.COD_LIVELLO,P.MISURA,P.PLURI_VALORE, P.PLURI_VALORE_SQL, P.QUERY_PLURIVALORE, P.EVAL,P.FLAG_MANUALE,
	P.INPUT_NUMERICO, P.DATETIME, P.TESTO_SEMPLICE, P.TESTO_AREA,PP.ID_PROGETTO,PP.ID_VALORE,PP.VALORE,PP.DATA_VALUTAZIONE,PP.OPERATORE_VALUTAZIONE,
	PP.MODIFICA_MANUALE,PP.PUNTEGGIO,V.DESCRIZIONE AS VALORE_DESC, VAL_DATA, VAL_TESTO  
	FROM BANDO B
		INNER JOIN SCHEDA_X_PRIORITA SP ON B.ID_SCHEDA_VALUTAZIONE=SP.ID_SCHEDA_VALUTAZIONE AND SELEZIONABILE=1
		INNER JOIN PRIORITA P ON SP.ID_PRIORITA=P.ID_PRIORITA AND P.COD_LIVELLO=@LIVELLO
		LEFT JOIN PRIORITA_X_PROGETTO PP ON P.ID_PRIORITA=PP.ID_PRIORITA AND ID_PROGETTO=@ID_PROGETTO
		LEFT JOIN VALORI_PRIORITA V ON PP.ID_VALORE=V.ID_VALORE
	WHERE B.ID_BANDO=@ID_BANDO ORDER BY ORDINE


